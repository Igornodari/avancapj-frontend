<div class="row">
  <div class="col-12 col-sm-2 col-lg-2 d-flex"></div>

  <div class="col-6 col-sm-10 col-lg-10 d-flex flex-row-reverse m-b-20">
    <button [matBadge]="filteredCount" matBadgeOverlap="true" class="m-x-10 m-t-5" mat-mini-fab color="accent"
      (click)="openDialogFilter()">
      <mat-icon>filter_list</mat-icon>
    </button>
  </div>
</div>

<mat-card class="cardWithShadow">
  <mat-card-content>
    <div class="main-container m-t-2">
      @if (loading) {
      <app-loading></app-loading>
      }

      <div class="table-responsive">
        <table mat-table [dataSource]="dataSource" class="main-table" matSort matSortActive="createdAt"
          matSortDisableClear matSortDirection="desc">
          <ng-container matColumnDef="createdAt">
            <th mat-sort-header mat-header-cell *matHeaderCellDef>
              {{ 'CREATED_AT' | translate }}
            </th>
            <td mat-cell *matCellDef="let row">{{ row.createdAt | date }}</td>
          </ng-container>
          <ng-container matColumnDef="function">
            <th mat-sort-header mat-header-cell *matHeaderCellDef>
              {{ 'SYSTEM.QUEUE_ERRORS.TABLE.QUEUE' | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              {{ row.function }}
            </td>
          </ng-container>
          <ng-container matColumnDef="cid">
            <th mat-sort-header mat-header-cell *matHeaderCellDef>
              {{ 'SYSTEM.QUEUE_ERRORS.TABLE.CID' | translate }}
            </th>
            <td mat-cell *matCellDef="let row">
              {{ row.cid }}
            </td>
          </ng-container>
          <ng-container matColumnDef="error">
            <th mat-sort-header mat-header-cell *matHeaderCellDef>
              {{ 'SYSTEM.QUEUE_ERRORS.TABLE.ERROR' | translate }}
            </th>

            <td mat-cell *matCellDef="let row" [matTooltip]="row.error">
              {{ row.error | truncate : 50 }}
            </td>
          </ng-container>

          <ng-container matColumnDef="visibilityIcon">
            <th mat-sort-header mat-header-cell *matHeaderCellDef>
              {{ 'ACTIONS' | translate }}
            </th>
            <td id="visibility-icon" mat-cell *matCellDef="let row">
              <button mat-icon-button color="primary" (click)="openDetail(row)" aria-label="visibility icon">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button color="primary" (click)="retry(row._id)" aria-label="retry icon">
                <mat-icon>reply</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
        @if (!dataSource.data.length) {
        <div class="rate-limit-reached">
          {{ 'NO_RESULTS' | translate }}
        </div>
        }
      </div>

      <mat-paginator [length]="resultsLength" [pageSize]="50" [pageSizeOptions]="pageSizeOptions"></mat-paginator>
    </div>
  </mat-card-content>
</mat-card>